<!DOCTYPE html>

<html>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>
    <h1>Liam Ryan</h1>
    <style type="text/css">
        body {
            background-color: white;
        }

        canvas {
            border: 5px solid black;
        }
    </style>

</head>

<body>

    <canvas id="canvas-for-ball" height="500" width="500"></canvas>

    <script type="text/javascript">
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("canvas-for-ball");
        // Get a 2D context for the canvas.
        var ctx = canvas.getContext("2d");

        class Paddle {
            //class attributes for paddle
            constructor(width, yPos, xPos) {
                this.width = width;
                this.xPos = xPos;
                this.yPos = yPos;
                this.score = 0;//start score 0

            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.xPos, this.yPos, this.width, 0, 2 * Math.PI);
                ctx.stroke();

            }
            //paddle x and y corodinate 
            move(movement) {
                if (movement == 3 && (this.yPos >= this.width)) {
                    this.yPos -= 10;//move up
                }
                else if (movement == 4 && (this.yPos <= canvas.height - this.width)) {
                    this.yPos += 10;//move down
                }
                else if (movement == 1 && (this.xPos >= this.width)) {
                    this.xPos -= 1;//move left
                }
                else if (movement == 2 && (this.xPos <= canvas.width - this.width)) {
                    this.xPos += 1;//move right
                }

            }
        }
        class Ball {
            constructor(xPos, yPos, xVelocity, yVelocity, radius, rotation) {
                //fields describing the object
                this.yPos = yPos;
                this.yVelocity = yVelocity;
                this.xPos = xPos;
                this.xVelocity = xVelocity;
                this.radius = radius;
                this.rotation = rotation;
                this.gravity = 0;
                this.msg = "";
                this.msgTime = null;
            }
            draw() {
                //Draw the ball (stroked,  filled red).
                ctx.beginPath();
                ctx.fillStyle = "red";
                ctx.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
            }
            //rotate takes argument rotate speed
            rotate(rotateSpeed) {
                //rotation speed
                this.rotation += rotateSpeed;
                //calculate the outer points of the circle for the peace symbol
                // x= (r*cos(0) + rotation)+ center x position of cirlce
                // y= (r*sin(0) + rotation)+ center y position of cirlce
                var y1 = (this.radius * Math.sin((Math.PI / 4) + this.rotation)) + this.yPos;
                var x1 = (this.radius * Math.cos((Math.PI / 4) + this.rotation)) + this.xPos;
                var y2 = (this.radius * Math.sin((3 * Math.PI / 4) + this.rotation)) + this.yPos;
                var x2 = (this.radius * Math.cos((3 * Math.PI / 4) + this.rotation)) + this.xPos;
                var y3 = (this.radius * Math.sin((Math.PI / 2) + this.rotation)) + this.yPos;
                var x3 = (this.radius * Math.cos((Math.PI / 2) + this.rotation)) + this.xPos;
                var y4 = (this.radius * Math.sin((6 * Math.PI / 4) + this.rotation)) + this.yPos;
                var x4 = (this.radius * Math.cos((6 * Math.PI / 4) + this.rotation)) + this.xPos;
                //move pen to center of cirlce
                ctx.moveTo(this.xPos, this.yPos);
                //draw line to outside point 1
                ctx.lineTo(x1, y1);
                ctx.moveTo(this.xPos, this.yPos);
                //draw line to outside point 2
                ctx.lineTo(x2, y2);
                ctx.moveTo(this.xPos, this.yPos);
                //draw line to outside point 3
                ctx.lineTo(x3, y3);
                ctx.moveTo(this.xPos, this.yPos);
                //draw line to outside point 4
                ctx.lineTo(x4, y4);
                ctx.stroke();
            }
            move(speed) {
                // Update the y and x location.
                this.yVelocity += this.gravity;
                //speed controls no working  as intended
                this.xVelocity += speed;
                this.yVelocity += speed;
                this.yPos += this.yVelocity;
                this.xPos += this.xVelocity;

                // Reverse ball direction on contact with bottom
                if (this.yPos >= canvas.height - this.radius) {
                    //prevent gravity acceleration pushing the ball down
                    this.yPos = canvas.height - this.radius;
                    //90% speed after bouncing
                    this.yVelocity *= -0.9;
                }
                // Reverse ball direction on contact with top
                else if (this.yPos <= this.radius) {
                    //reset the ball to prevent going through the top
                    this.yPos = this.radius;
                    //90% speed after bouncing
                    this.yVelocity *= -0.9;
                }
                // Bounce from side to side
                if (this.xPos >= canvas.width - this.radius) {
                    this.xPos = canvas.width - this.radius;
                    this.xVelocity *= -0.9;
                    if (myPaddle2.score > 0) {
                        myPaddle2.score--; //decrement score;
                    }
                    console.log(this.xVelocity);
                }
                else if (this.xPos <= this.radius) {
                    this.xPos = this.radius;
                    this.xVelocity *= -0.9;
                    if (myPaddle.score > 0) {
                        myPaddle.score--; //decrement score;
                    }
                    console.log(this.xVelocity);
                }
            }
            collision() {
                //distance between ball and paddles
                var leftCollision = Math.sqrt(Math.pow(this.xPos - myPaddle.xPos, 2) + Math.pow(this.yPos - myPaddle.yPos, 2));
                var rightCollision = Math.sqrt(Math.pow(this.xPos - myPaddle2.xPos, 2) + Math.pow(this.yPos - myPaddle2.yPos, 2));
                if (leftCollision <= (this.radius + myPaddle.width)) {

                    this.xVelocity = this.xVelocity * -1;//invert the direction of travel
                    this.xPos += this.xVelocity * 1;
                    myPaddle.score++;//increment score on collision
                    this.collisionMessage("Collision detected left");
                }
                else if (rightCollision <= (this.radius + myPaddle2.width)) {
                    this.xVelocity = this.xVelocity * -1;//invert the direction of travel
                    this.xPos = this.xPos + this.xVelocity * 1;//add distance so that the ball can escape contact
                    myPaddle2.score++;//increment score on collision
                    this.collisionMessage("Collision detected right");
                }
            }
            collisionMessage(newMsg) {
                this.msg = newMsg;
                if (this.msgTime) clearTimeout(this.msgTime);//checks if a msg timer is already active if there is clears it
                this.msgTime = setTimeout(() => {//runs the following code after the delay 
                    this.msg = ""; // Clear the message after 0.75 seconds
                }, 750);//delay in miliseconds
            }
            drawMsg() {
                if (this.msg) {//checks if the msg variable contains anything if it does print in the center of the canvas
                    ctx.font = "30px times new roman";
                    ctx.fillStyle = "black";
                    ctx.textAlign = "center";
                    ctx.fillText(this.msg, canvas.width / 2, canvas.height / 2);
                }
                ctx.font = "30px times new roman";
                ctx.fillStyle = "black";
                ctx.textAlign = "center";
                let score1 = String(myPaddle.score).padStart(3, '0');//ensures score is 3 digits in length when score is less than 3 digits replaces missing digits with 0
                let score2 = String(myPaddle2.score).padStart(3, '0');
                ctx.fillText("Score 1:" + score1, 125, 50);
                ctx.fillText("Score 2:" + score2, 300, 50);

            }
        }

        //create object myball
        myBall = new Ball(250, 249, 15, 15, 49, 0);
        myPaddle = new Paddle(26, 100, 50);
        myPaddle2 = new Paddle(26, 100, 450);
        var rotateSpeed = 0.025;
        var speed = 0;
        var mousePosition;
        //Add a Javascript event listener to the keypress event.
        window.addEventListener("keypress", function (event) {
            // Just log the event to the console.
            console.log(event);
        });
        //keypresses with jQuery
        $(document.body).on('keydown', function (e) {
            console.log(e.which);
            switch (e.which) {
                // key code for left arrow
                case 37:
                    myPaddle.move(1);
                    console.log('left arrow key pressed!');
                    break;
                //key code for up arrow
                case 38:
                    myPaddle.move(3);
                    console.log('up arrow pressed');
                    break;
                // key code for right arrow
                case 39:
                    myPaddle.move(2);
                    console.log('right arrow key pressed!');
                    break;
                // key code for down arrow
                case 40:
                    myPaddle.move(4);
                    console.log('down arrow pressed');
                    break;
                case 65:
                    myPaddle2.move(1);
                    console.log('left arrow key pressed!');
                    break;
                //Second Paddle
                //W
                case 87:
                    myPaddle2.move(3);
                    console.log('up arrow pressed');
                    break;
                //D
                case 68:
                    myPaddle2.move(2);
                    console.log('right arrow key pressed!');
                    break;
                //S
                case 83:
                    myPaddle2.move(4);
                    console.log('down arrow pressed');
                    break;
                //Rotation
                //z
                case 90:
                    //slow down/invert rotatespeed
                    //if statement to prevent inverse rotation
                    if (rotateSpeed > 0) {
                        rotateSpeed = rotateSpeed - 0.025;
                        //if speed is below the cap set it to the cap
                        if (rotateSpeed < 0) {
                            rotateSpeed = 0;
                        }
                    }
                    console.log(rotateSpeed);
                    break;
                //x
                case 88:
                    //increase rotate speed
                    //if statement for rotation cap
                    if (rotateSpeed < 0.1) {
                        rotateSpeed = rotateSpeed + 0.025;
                        //if speed is above the cap set it to the cap
                        if (rotateSpeed > 0.1) {
                            rotateSpeed = 0.1;
                        }
                    }
                    console.log(rotateSpeed);
                    break;
                //Speed of ball
                //e
                case 69:
                    //increase speed
                    if (speed < 0.1) {
                        speed = speed + 0.025;
                        //if speed is above the cap set it to the cap
                        if (speed > 0.1) {
                            speed = 0.1;
                        }
                    }
                    break;
                //q
                case 81:
                    //decrease speed
                    if (speed > 0) {
                        speed -= 0.1;
                        if (speed < 0) {
                            speed = 0;
                        }
                    }
                    break;
            }
        });
        //listen for mouse movement in y 
        canvas.addEventListener("mousemove", function (event) {
            mousePosition = event.clientY - canvas.offsetTop;
            if (mousePosition >= myPaddle.width && mousePosition <= canvas.height - myPaddle.width) {
                myPaddle.yPos = mousePosition
            }
        });
        function repeatme() {
            //clear canvas every frame
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            myPaddle2.draw();
            myPaddle.draw();
            myBall.draw();
            myBall.rotate(rotateSpeed);
            myBall.move(speed);
            myBall.collision();
            myBall.drawMsg();
            window.requestAnimationFrame(repeatme);
        }
        // Get the animation going.
        repeatme();
    </script>
</body>

</html>